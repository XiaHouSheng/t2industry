import{a as pe,k as B,p as he,l as Z,G as f,b as U,o as m,i as l,d as t,g as e,v as Re,c as y,V as _e,e as E,w as r,u as ne,y as A,R as fe,j as F,z as q,W as ue,A as O,X as me,t as G,Y as je,Z as Le,_ as ve,F as N,r as Y,a0 as Ee,a1 as Ae,a2 as qe,a3 as Fe,m as Te,a4 as Oe,a5 as Ge,a6 as He,D as ae}from"./vendor-Ccy1iyrD.js";import{_ as W,T as Ne,a as We,S as Qe,L as Je,b as K,D as ee,c as te,d as oe,e as ce,f as be,Q as Xe,g as we,h as xe,I as Ye,t as R,i as Ze,P as Ce,j as I,A as Ke,k as et,G as tt,R as ot,W as lt,l as at,m as st,n as nt,o as rt,p as it,q as dt,r as ut}from"./components-BOV_PMtb.js";import{b as re,u as ct,c as pt}from"./stores-BHI_I-r_.js";import{b as se,c as gt,d as ft,g as mt,i as ye,C as X}from"./utils-DKI4o8xi.js";const vt={class:"sheng-root-container"},yt={class:"root-container"},ht={class:"root-main"},_t={__name:"root",setup(Q){const n=pe(),s=B("/home");he(()=>n.path,$=>{const x="/"+$.split("/")[1];s.value=x}),Z(()=>{const $="/"+n.path.split("/")[1];s.value=$});const u=$=>{s.value=$};return($,x)=>{const D=f("RouterView");return m(),U("div",vt,[l(e(Ne),{"default-active":s.value,onSelect:u},null,8,["default-active"]),t("div",yt,[t("div",ht,[l(D)]),x[0]||(x[0]=Re('<div class="root-footer" data-v-75f8b721><div class="footer-divider" data-v-75f8b721></div><div class="footer-content" data-v-75f8b721><div class="footer-text" data-v-75f8b721> T2Blueprint | 基于 Vue3 + Element Plus + Gridstack.js 开发 | MIT 开源协议 </div><div class="footer-text" data-v-75f8b721> 网站备案/许可证号 <a href="https://beian.miit.gov.cn/" class="footer-link" data-v-75f8b721>粤ICP备2026009977号</a></div></div></div>',1))])])}}},$o=W(_t,[["__scopeId","data-v-75f8b721"]]),bt={class:"h-[780px] p-[15px] bg-[#111827] shadow-xl flex flex-col"},wt={class:"relative"},xt={class:"relative"},Ct={key:0,class:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm"},St=["disabled"],kt={class:"relative"},Bt={class:"relative"},$t={class:"relative"},Pt={class:"flex gap-2"},Vt={class:"relative flex-1"},Mt=["disabled"],Dt={class:"relative"},Ut={class:"relative"},It={key:0,class:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm"},zt=["disabled"],Rt={class:"h-[780px] bg-[#1a1a1a] shadow-xl flex flex-col"},jt={class:"flex-1 overflow-y-auto overflow-x-hidden relative"},Lt={__name:"home",setup(Q){const n=ne(),s=pe(),u=re(),$=y(()=>s.path);y(()=>{switch(s.path){case"/home":return"蓝图中枢 - HUB";case"/home/discover":return"发现蓝图 - DISCOVER";case"/home/self":return"个人蓝图 - SELF";default:return"我的"}});const x=B(!1),D=B(!1);B(!0);const v=B({username:"",password:""}),i=B({username:"",password:"",confirmPassword:"",nickname:"",email:"",verificationCode:""}),o=B(!1),_=B(!1),C=B(""),h=B(""),z=M=>{n.push(M)},b=()=>{x.value=!0,C.value=""},k=()=>{x.value=!1,C.value=""},c=()=>{D.value=!0,h.value=""},P=()=>{D.value=!1,h.value=""},a=async()=>{try{o.value=!0,C.value="";const M=await u.login(v.value);k(),await u.refreshData()}catch(M){C.value=M.message||"登录失败",console.error("登录失败:",M)}finally{o.value=!1}},V=async()=>{try{if(!i.value.email){h.value="请输入邮箱";return}h.value="";const M=await u.sendVerificationCode(i.value.email);h.value=M.message}catch(M){h.value=M.message||"发送验证码失败",console.error("发送验证码失败:",M)}},T=async()=>{try{if(i.value.password!==i.value.confirmPassword){h.value="两次输入的密码不一致";return}if(!i.value.username||!i.value.password||!i.value.email||!i.value.verificationCode||!i.value.nickname){h.value="请填写所有必要字段";return}_.value=!0,h.value="";const M=await u.register({username:i.value.username,password:i.value.password,nickname:i.value.nickname,email:i.value.email,verificationCode:i.value.verificationCode});P(),C.value="注册成功，请登录",b(),i.value={username:"",password:"",confirmPassword:"",nickname:"",email:"",verificationCode:""},u.clearCountdown()}catch(M){h.value=M.message||"注册失败",console.error("注册失败:",M)}finally{_.value=!1}},L=async()=>{u.checkLoginStatus(),await u.refreshData()};return Z(()=>{L()}),_e(()=>{u.clearCountdown()}),(M,g)=>{const j=f("el-col"),ie=f("router-view"),de=f("el-row");return m(),E(de,{gutter:6},{default:r(()=>[l(j,{span:4},{default:r(()=>[t("div",bt,[l(e(We),{userInfo:e(u).userInfo},null,8,["userInfo"]),g[12]||(g[12]=t("div",{class:"h-px bg-gray-800 my-2"},null,-1)),l(e(Qe),{"active-menu":$.value,onSelect:z},null,8,["active-menu"]),l(e(Je),{onLogin:b,onRegister:c}),l(e(K),{open:x.value,"onUpdate:open":g[2]||(g[2]=S=>x.value=S)},{default:r(()=>[l(e(ee),null,{default:r(()=>[l(e(te),null,{default:r(()=>[l(e(oe),null,{default:r(()=>[...g[10]||(g[10]=[A("用户登录",-1)])]),_:1})]),_:1}),t("form",{onSubmit:fe(a,["prevent"]),class:"space-y-4"},[t("div",null,[t("div",wt,[l(e(ue),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),q(t("input",{"onUpdate:modelValue":g[0]||(g[0]=S=>v.value.username=S),type:"text",placeholder:"请输入用户名",autocomplete:"username",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-700 bg-gray-850 text-white placeholder-gray-500 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 transition-colors"},null,512),[[O,v.value.username]])])]),t("div",null,[t("div",xt,[l(e(me),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),q(t("input",{"onUpdate:modelValue":g[1]||(g[1]=S=>v.value.password=S),type:"password",placeholder:"请输入密码",autocomplete:"password",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-700 bg-gray-850 text-white placeholder-gray-500 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 transition-colors"},null,512),[[O,v.value.password]])])]),C.value?(m(),U("div",Ct,G(C.value),1)):F("",!0)],32),l(e(ce),null,{default:r(()=>[t("button",{onClick:k,class:"px-4 py-2 rounded-lg border border-gray-700 bg-gray-800 text-gray-300 hover:bg-gray-700 transition-colors"}," 取消 "),t("button",{onClick:a,disabled:o.value,class:"px-4 py-2 rounded-lg bg-yellow-500 text-gray-900 hover:bg-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors min-w-[80px]"},G(o.value?"登录中...":"登录"),9,St)]),_:1})]),_:1})]),_:1},8,["open"]),l(e(K),{open:D.value,"onUpdate:open":g[9]||(g[9]=S=>D.value=S)},{default:r(()=>[l(e(ee),null,{default:r(()=>[l(e(te),null,{default:r(()=>[l(e(oe),null,{default:r(()=>[...g[11]||(g[11]=[A("用户注册",-1)])]),_:1})]),_:1}),t("form",{onSubmit:fe(T,["prevent"]),class:"space-y-4"},[t("div",null,[t("div",kt,[l(e(ue),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),q(t("input",{"onUpdate:modelValue":g[3]||(g[3]=S=>i.value.username=S),type:"text",placeholder:"请输入用户名",autocomplete:"username",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-700 bg-gray-850 text-white placeholder-gray-500 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 transition-colors"},null,512),[[O,i.value.username]])])]),t("div",null,[t("div",Bt,[l(e(je),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),q(t("input",{"onUpdate:modelValue":g[4]||(g[4]=S=>i.value.nickname=S),type:"text",placeholder:"请输入昵称",autocomplete:"nickname",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-700 bg-gray-850 text-white placeholder-gray-500 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 transition-colors"},null,512),[[O,i.value.nickname]])])]),t("div",null,[t("div",$t,[l(e(Le),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),q(t("input",{"onUpdate:modelValue":g[5]||(g[5]=S=>i.value.email=S),type:"email",placeholder:"请输入邮箱",autocomplete:"email",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-700 bg-gray-850 text-white placeholder-gray-500 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 transition-colors"},null,512),[[O,i.value.email]])])]),t("div",null,[t("div",Pt,[t("div",Vt,[l(e(ve),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),q(t("input",{"onUpdate:modelValue":g[6]||(g[6]=S=>i.value.verificationCode=S),type:"text",placeholder:"请输入验证码",autocomplete:"one-time-code",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-700 bg-gray-850 text-white placeholder-gray-500 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 transition-colors"},null,512),[[O,i.value.verificationCode]])]),t("button",{type:"button",onClick:V,disabled:e(u).sendCodeLoading||e(u).codeCountdown>0,class:"px-4 py-2.5 rounded-lg border border-gray-700 bg-gray-800 text-gray-300 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors whitespace-nowrap min-w-[120px]"},G(e(u).codeCountdown>0?`${e(u).codeCountdown}s后重发`:"发送验证码"),9,Mt)])]),t("div",null,[t("div",Dt,[l(e(me),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),q(t("input",{"onUpdate:modelValue":g[7]||(g[7]=S=>i.value.password=S),type:"password",placeholder:"请输入密码",autocomplete:"new-password",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-700 bg-gray-850 text-white placeholder-gray-500 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 transition-colors"},null,512),[[O,i.value.password]])])]),t("div",null,[t("div",Ut,[l(e(ve),{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-4 h-4"}),q(t("input",{"onUpdate:modelValue":g[8]||(g[8]=S=>i.value.confirmPassword=S),type:"password",placeholder:"请确认密码",autocomplete:"new-password",class:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-700 bg-gray-850 text-white placeholder-gray-500 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 transition-colors"},null,512),[[O,i.value.confirmPassword]])])]),h.value?(m(),U("div",It,G(h.value),1)):F("",!0)],32),l(e(ce),null,{default:r(()=>[t("button",{onClick:P,class:"px-4 py-2 rounded-lg border border-gray-700 bg-gray-800 text-gray-300 hover:bg-gray-700 transition-colors"}," 取消 "),t("button",{onClick:T,disabled:_.value,class:"px-4 py-2 rounded-lg bg-yellow-500 text-gray-900 hover:bg-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors min-w-[80px]"},G(_.value?"注册中...":"注册"),9,zt)]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1}),l(j,{span:20},{default:r(()=>[t("div",Rt,[g[13]||(g[13]=t("img",{src:"https://patchwiki.biligame.com/images/zmd/0/0a/7oc2v8kqfgzaltfwm42og404l57kha4.png",alt:"装饰图片",class:"absolute top-1/2 left-3/5 -translate-x-1/2 -translate-y-1/2 w-[700px] h-[700px] object-contain opacity-50 pointer-events-none z-0"},null,-1)),t("div",jt,[l(ie,{onOpenLoginDialog:b})])])]),_:1})]),_:1})}}},Et=W(Lt,[["__scopeId","data-v-8679676a"]]),Po=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"})),At={class:"quick-links-section mx-6 mt-6"},qt={class:"quick-links-grid"},Ft={class:"blueprint-section mx-6 mt-6"},Tt={class:"blueprint-grid"},Ot={key:0,class:"text-center py-8"},Gt={class:"stats-section mx-6 mt-6"},Ht={class:"intro-section mx-6 mt-6 mb-6"},Nt={__name:"index",setup(Q){const n=re(),s=ne(),u=y(()=>n.totalBlueprints),$=y(()=>n.totalUsers),x=y(()=>n.totalViews),D=y(()=>n.totalDownloads),v=y(()=>n.hotBlueprints),i=y(()=>n.loading.stats),o=y(()=>n.error),_=y(()=>({blueprints:u.value,users:$.value,views:x.value,downloads:D.value}));y(()=>{const c={四号谷地:0,武陵:0};return Array.isArray(n.hotBlueprints)&&n.hotBlueprints.forEach(P=>{P.area==="四号谷地"&&c.四号谷地++,P.area==="武陵"&&c.武陵++}),c});const C=[{name:"蓝图编辑器",path:"/editor",description:"创建和编辑你的蓝图",icon:Ee},{name:"发现蓝图",path:"/home/discover",description:"浏览其他玩家的蓝图",icon:Ae},{name:"个人蓝图",path:"/home/self",description:"管理你的蓝图",icon:ue},{name:"计算器",path:"/calculate",description:"物料配平计算",icon:qe}],h=async c=>{try{c.fileHash?(n.getBlueprintById(c.id),s.push(`/editor/${c.fileHash}`)):R.warning("该蓝图缺少文件哈希，无法直接查看")}catch(P){console.error("查看蓝图失败:",P),R.error("操作失败，请重试")}},z=async c=>{},b=c=>{};Z(()=>{(!Array.isArray(n.hotBlueprints)||n.hotBlueprints.length===0)&&n.loadStats()});const k=()=>{n.loadStats()};return(c,P)=>{const a=f("el-empty"),V=f("el-col"),T=f("el-row");return m(),E(T,{gutter:12},{default:r(()=>[l(V,{span:24},{default:r(()=>[o.value?(m(),E(e(be),{key:0,title:o.value,type:"error","show-icon":"",onRetry:k},null,8,["title"])):F("",!0),t("div",At,[t("div",qt,[(m(),U(N,null,Y(C,L=>l(e(Xe),{key:L.name,link:L},null,8,["link"])),64))])]),t("div",Ft,[t("div",Tt,[(m(!0),U(N,null,Y(v.value,L=>(m(),E(e(we),{key:L.id,blueprint:L,loading:i.value,onView:h,onShare:z,onBilibili:b},null,8,["blueprint","loading"]))),128))]),!i.value&&v.value.length===0?(m(),U("div",Ot,[l(a,{description:"暂无热门蓝图"})])):F("",!0)]),t("div",Gt,[l(e(xe),{loading:i.value,stats:_.value},null,8,["loading","stats"])]),t("div",Ht,[l(e(Ye))])]),_:1})]),_:1})}}},Wt=W(Nt,[["__scopeId","data-v-1fcd4be8"]]),Vo=Object.freeze(Object.defineProperty({__proto__:null,default:Wt},Symbol.toStringTag,{value:"Module"})),Qt={class:"blueprint-section mx-6 mt-6 mb-6"},Jt={class:"blueprint-grid"},Xt={key:0,class:"empty-state"},Yt={key:1,class:"pagination-container"},Zt={__name:"discover",setup(Q){const n=re(),s=ne(),u=B(["四号谷地","武陵"]),$=y(()=>n.discoverBlueprints),x=y(()=>n.total),D=y({get:()=>n.currentPage,set:a=>n.setSearchFilters({page:a})}),v=y({get:()=>n.pageSize,set:a=>n.setSearchFilters({pageSize:a})}),i=y({get:()=>n.searchQuery,set:a=>n.setSearchFilters({search:a})}),o=y({get:()=>n.selectedArea,set:a=>n.setSearchFilters({area:a})}),_=y(()=>n.loading.discover),C=y(()=>n.error),h=a=>{n.loadDiscoverBlueprints(a)},z=()=>{n.loadDiscoverBlueprints(1)},b=a=>{console.log("size",a),n.setSearchFilters({pageSize:a}),n.loadDiscoverBlueprints(1)},k=async a=>{},c=async a=>{try{a.fileHash?(n.getBlueprintById(a.id),s.push(`/editor/${a.fileHash}`)):I.warning("该蓝图缺少文件哈希，无法直接查看")}catch(V){console.error("查看蓝图失败:",V),I.error("操作失败，请重试")}},P=a=>{};return Z(()=>{n.loadDiscoverBlueprints(1)}),(a,V)=>{const T=f("el-button"),L=f("el-alert"),M=f("el-col"),g=f("el-row");return m(),E(g,{gutter:12},{default:r(()=>[l(M,{span:24},{default:r(()=>[l(e(Ze),{"search-query":i.value,"onUpdate:searchQuery":V[0]||(V[0]=j=>i.value=j),"selected-area":o.value,"onUpdate:selectedArea":V[1]||(V[1]=j=>o.value=j),areas:u.value,onSearch:z,class:"mx-6 mt-6"},null,8,["search-query","selected-area","areas"]),C.value?(m(),E(L,{key:0,title:C.value,type:"error",closable:!1,"show-icon":"",class:"mb-4 mx-6 mt-6"},{default:r(()=>[l(T,{type:"primary",size:"small",onClick:a.loadBlueprints},{default:r(()=>[...V[2]||(V[2]=[A("重试",-1)])]),_:1},8,["onClick"])]),_:1},8,["title"])):F("",!0),t("div",Qt,[t("div",Jt,[(m(!0),U(N,null,Y($.value,j=>(m(),E(e(we),{key:j.id,blueprint:j,loading:_.value,onView:c,onShare:k,onBilibili:P},null,8,["blueprint","loading"]))),128))]),!_.value&&$.value.length===0?(m(),U("div",Xt,[...V[3]||(V[3]=[t("div",{class:"text-center py-12"},[t("div",{class:"text-gray-500 text-lg"},"暂无符合条件的蓝图")],-1)])])):F("",!0),!_.value&&x.value>0?(m(),U("div",Yt,[l(e(Ce),{"current-page":D.value,"page-size":v.value,"page-sizes":[12,24,36],layout:"total, sizes, prev, pager, next, jumper",total:x.value,onSizeChange:b,onCurrentChange:h},null,8,["current-page","page-size","total"])])):F("",!0)])]),_:1})]),_:1})}}},Kt=W(Zt,[["__scopeId","data-v-c3b24d14"]]),Mo=Object.freeze(Object.defineProperty({__proto__:null,default:Kt},Symbol.toStringTag,{value:"Module"})),eo={class:"stats-section mx-6 mt-6"},to={class:"blueprint-section mx-6 mt-6"},oo={key:0,class:"text-center py-8"},lo={key:1,class:"blueprint-grid"},ao={key:1,class:"pagination-container mx-6 mt-6"},so=["disabled"],no={class:"guide-section mx-6 mt-6 mb-6"},ro={__name:"self",setup(Q){const n=re(),s=ne(),u=B(""),$=B(["四号谷地","武陵"]),x=B([{id:1,name:"本地蓝图",description:"本地保存的蓝图",createdAt:"2026-01-10",lastEdited:"2026-01-12",area:"塔卫二",thumbnail:"#",type:"local"}]),D=B(!1),v=B({name:"",description:"",area:"",file:null}),i=B(!1),o=B(null),_={name:[{required:!0,message:"请输入蓝图名称",trigger:"blur"},{min:1,max:50,message:"名称长度在 1 到 50 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入蓝图描述",trigger:"blur"},{min:1,max:200,message:"描述长度在 1 到 200 个字符",trigger:"blur"}],area:[{required:!0,message:"请选择地区",trigger:"change"}],file:[{required:!0,message:"请选择蓝图文件",trigger:"change"}]},C=B(null),h=B(!1),z=y(()=>n.userInfo.isLoggedIn?[...x.value,...n.allBlueprints]:x.value),b=y(()=>u.value?z.value.filter(p=>p.area===u.value):z.value),k=async p=>{try{p.fileHash?s.push(`/editor/${p.fileHash}`):s.push("/editor")}catch(d){console.error("编辑蓝图失败:",d),R.error("操作失败，请重试")}},c=async p=>{try{if(!p.fileHash){R.warning("本地蓝图不需要重新上传");return}const d=document.createElement("input");d.type="file",d.accept=".json",d.onchange=async J=>{const H=J.target.files[0];if(H)try{p.uploading=!0,await se.uploadBlueprint(p.id,H),await n.loadBlueprints(),R.success("蓝图重新上传成功")}catch(le){R.error(le.message||"蓝图重新上传失败"),console.error("蓝图重新上传失败:",le)}finally{p.uploading=!1}},d.click()}catch(d){console.error("重新上传蓝图失败:",d),R.error("操作失败，请重试")}},P=async p=>{try{if(!p.fileHash){R.warning("本地蓝图无法分享");return}}catch(d){console.error("分享蓝图失败:",d),R.error("操作失败，请重试")}},a=p=>{o.value=p,i.value=!0},V=async()=>{if(o.value)try{await se.deleteBlueprint(o.value.id),await n.loadBlueprints(),i.value=!1,o.value=null,R.success("蓝图删除成功")}catch(p){R.error(p.message||"蓝图删除失败"),console.error("蓝图删除失败:",p)}},T=()=>{i.value=!1,o.value=null},L=()=>{if(!n.userInfo.isLoggedIn){R.warning("请先登录后再上传蓝图");return}v.value={name:"",description:"",area:"",file:null},D.value=!0},M=y(()=>z.value.length),g=y(()=>n.userInfo.isLoggedIn?n.allBlueprints.length:0),j=y(()=>{const p={四号谷地:0,武陵:0};return z.value.forEach(d=>{p.hasOwnProperty(d.area)&&p[d.area]++}),p}),ie=y(()=>({blueprints:M.value,users:g.value,views:j.value.四号谷地,downloads:j.value.武陵})),de=y(()=>({blueprints:"总蓝图数",users:"上传蓝图",views:"四号谷地",downloads:"武陵"})),S=p=>{p?v.value.file=p.raw:v.value.file=null},Se=async()=>{if(C.value)try{await C.value.validate(),h.value=!0;const p={name:v.value.name,description:v.value.description,area:v.value.area},J=(await se.createBlueprint(p)).data.id;await se.uploadBlueprint(J,v.value.file),await n.loadBlueprints(),D.value=!1,R.success("蓝图上传成功")}catch(p){R.error(p.message||"蓝图上传失败"),console.error("蓝图上传失败:",p)}finally{h.value=!1}},ke=()=>{D.value=!1,C.value&&C.value.resetFields()},Be=async()=>{n.userInfo.isLoggedIn&&(!Array.isArray(n.allBlueprints)||n.allBlueprints.length===0)&&await n.loadBlueprints()},$e=async p=>{await n.loadBlueprints({limit:p,page:1})},Pe=async p=>{await n.loadBlueprints({page:p})};return Z(()=>{Be()}),(p,d)=>{const J=f("el-input"),H=f("el-form-item"),le=f("el-option"),Ve=f("el-select"),Me=f("el-upload"),De=f("el-form"),ge=f("el-button"),Ue=f("el-dialog"),Ie=f("el-col"),ze=f("el-row");return m(),E(ze,{gutter:12},{default:r(()=>[l(Ie,{span:24},{default:r(()=>[e(n).userInfo.isLoggedIn?F("",!0):(m(),E(e(be),{key:0,title:"请先登录以查看和管理您的蓝图",type:"info","show-icon":""},{default:r(()=>[t("button",{onClick:d[0]||(d[0]=w=>p.$emit("openLoginDialog")),class:"px-4 py-2 text-sm font-medium rounded bg-yellow-500 text-gray-900 hover:bg-yellow-400 transition-colors"}," 去登录 ")]),_:1})),t("div",eo,[l(e(xe),{stats:ie.value,labels:de.value},null,8,["stats","labels"])]),l(e(Ke),{"selected-area":u.value,"onUpdate:selectedArea":d[1]||(d[1]=w=>u.value=w),areas:$.value,"is-logged-in":e(n).userInfo.isLoggedIn,loading:e(n).loading.blueprints,onUpload:L,class:"mx-6 mt-6"},null,8,["selected-area","areas","is-logged-in","loading"]),t("div",to,[b.value.length===0?(m(),U("div",oo,[...d[9]||(d[9]=[t("div",{class:"text-gray-500 text-lg"},"暂无蓝图数据",-1)])])):(m(),U("div",lo,[(m(!0),U(N,null,Y(b.value,w=>(m(),E(e(et),{key:w.id,blueprint:w,loading:e(n).loading.blueprints,onEdit:k,onReupload:c,onShare:P,onDelete:a},null,8,["blueprint","loading"]))),128))]))]),e(n).userInfo.isLoggedIn&&e(n).userBlueprintsTotal>0?(m(),U("div",ao,[l(e(Ce),{"current-page":e(n).userBlueprintsPage,"onUpdate:currentPage":d[2]||(d[2]=w=>e(n).userBlueprintsPage=w),"page-size":e(n).userBlueprintsLimit,"onUpdate:pageSize":d[3]||(d[3]=w=>e(n).userBlueprintsLimit=w),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:e(n).userBlueprintsTotal,onSizeChange:$e,onCurrentChange:Pe},null,8,["current-page","page-size","total"])])):F("",!0),l(e(K),{open:D.value,"onUpdate:open":d[7]||(d[7]=w=>D.value=w)},{default:r(()=>[l(e(ee),{"max-width":"max-w-md"},{default:r(()=>[l(e(te),null,{default:r(()=>[l(e(oe),null,{default:r(()=>[...d[10]||(d[10]=[A("上传蓝图",-1)])]),_:1})]),_:1}),l(De,{ref_key:"uploadFormRef",ref:C,model:v.value,rules:_,"label-width":"80px",class:"space-y-4"},{default:r(()=>[l(H,{label:"蓝图名称",prop:"name"},{default:r(()=>[l(J,{modelValue:v.value.name,"onUpdate:modelValue":d[4]||(d[4]=w=>v.value.name=w),placeholder:"请输入蓝图名称",class:"!bg-gray-800 !border-gray-700 !text-gray-300"},null,8,["modelValue"])]),_:1}),l(H,{label:"蓝图描述",prop:"description"},{default:r(()=>[l(J,{modelValue:v.value.description,"onUpdate:modelValue":d[5]||(d[5]=w=>v.value.description=w),type:"textarea",placeholder:"请输入蓝图描述",rows:3,class:"!bg-gray-800 !border-gray-700 !text-gray-300"},null,8,["modelValue"])]),_:1}),l(H,{label:"地区",prop:"area"},{default:r(()=>[l(Ve,{modelValue:v.value.area,"onUpdate:modelValue":d[6]||(d[6]=w=>v.value.area=w),placeholder:"请选择地区",class:"!bg-gray-800 !border-gray-700 !text-gray-300"},{default:r(()=>[(m(!0),U(N,null,Y($.value,w=>(m(),E(le,{key:w,label:w||"全部地区",value:w},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(H,{label:"蓝图文件",prop:"file"},{default:r(()=>[l(Me,{class:"upload-demo",action:"","auto-upload":!1,"on-change":S,limit:1,"file-list":[],accept:".json"},{tip:r(()=>[...d[11]||(d[11]=[t("div",{class:"el-upload__tip text-gray-400 text-sm"}," 请选择 .json 格式的文件 ",-1)])]),default:r(()=>[d[12]||(d[12]=t("button",{type:"button",class:"px-4 py-0.1 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500 transition-colors"}," 选择文件 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),l(e(ce),null,{default:r(()=>[t("button",{class:"px-3 py-1.5 rounded border border-gray-700 bg-gray-800 text-gray-300 hover:bg-gray-700 transition-colors text-sm",onClick:ke}," 取消 "),t("button",{class:"px-3 py-1.5 rounded bg-yellow-400 text-gray-900 hover:bg-yellow-500 transition-colors text-sm",disabled:h.value,onClick:Se},G(h.value?"上传中...":"上传"),9,so)]),_:1})]),_:1})]),_:1},8,["open"]),l(Ue,{modelValue:i.value,"onUpdate:modelValue":d[8]||(d[8]=w=>i.value=w),title:"确认删除",width:"400px","close-on-click-modal":!1},{footer:r(()=>[t("span",null,[l(ge,{onClick:T},{default:r(()=>[...d[13]||(d[13]=[A("取消",-1)])]),_:1}),l(ge,{type:"danger",onClick:V},{default:r(()=>[...d[14]||(d[14]=[A("确认删除",-1)])]),_:1})])]),default:r(()=>[t("p",null,'您确定要删除蓝图 "'+G(o.value?.name||"未命名蓝图")+'" 吗？此操作不可撤销。',1)]),_:1},8,["modelValue"]),t("div",no,[l(e(tt))])]),_:1})]),_:1})}}},io=W(ro,[["__scopeId","data-v-857dcbaf"]]),Do=Object.freeze(Object.defineProperty({__proto__:null,default:io},Symbol.toStringTag,{value:"Module"})),uo={};function co(Q,n){return m(),U("h1",null,"calculate")}const po=W(uo,[["render",co]]),Uo=Object.freeze(Object.defineProperty({__proto__:null,default:po},Symbol.toStringTag,{value:"Module"})),go={class:"h-[60%]"},fo={class:"display-flex flex-direation-col sheng-cont-list sidebar"},mo=["data-gs-widget"],vo={class:"display-flex flex-direation-col justify-content-center",style:{"margin-left":"3px"}},yo={class:"display-flex flex-direation-col justify-content-center"},ho={style:{"font-size":"14px"}},_o={class:"flex flex-row p-2 bg-gray-800 border-b border-gray-700 rounded-t-lg sheng-tool-bar-cont"},bo={class:"w-full h-10 gap-2 items-center px-3 sheng-tool-bar display-flex flex-direation-row"},wo={__name:"simulation",setup(Q){const{appContext:n}=Fe(),s=ct(),u=pt(),$=pe(),x=$.params.hashCode;Z(async()=>{await Te();const i=document.querySelector("#grid-stack"),o=document.querySelector(".sheng-cont-grid"),_=document.querySelector(".selection-box"),C=document.querySelector(".sheng-overlay"),h=document.querySelector("#pipe-grid");if(u.initSelector(_),s.initGrid(i,o,C,n),s.initPipeGrid(h),x)try{I.info(`正在加载蓝图: ${x}`),await s.loadBlueprintByHashCode(x),I.success(`蓝图 ${x} 加载成功！`)}catch(b){console.error("加载蓝图失败：",b),I.error(`加载蓝图失败: ${b.message}`)}else try{s.loadLocalBlueprint()&&I.success("本地蓝图加载成功！")}catch(b){console.error("加载本地蓝图失败：",b),I.error(`加载本地蓝图失败: ${b.message}`)}const z=b=>{const k=b.cloneNode(!0);k.replaceChildren(),k.classList.remove("sheng-cont-item","sheng-cont-item-spec");const c=JSON.parse(k.getAttribute("data-gs-widget")),a=`${c.id}_${Date.now()}_${Math.floor(Math.random()*1e3)}`;return c.id=a,k.setAttribute("data-gs-widget",JSON.stringify(c)),k};s.rootGrid.on("dropped",(b,k,c)=>{if(!s.rootPipeGrid.isAreaEmpty(c.x,c.y,c.w,c.h)){s.rootGrid.removeWidget(c.el,!0),I.error("该位置已被占用，请选择其他位置");return}}),s.rootGrid.on("added",(b,k)=>{const c=k[0],P=c.el,a=c.id.split("_")[0];if(!P.classList.contains("sidebar-item"))return;s.gridWidgets[c.id]={rotate:0,recipe:"",part:s.editPartChoose},s.gridWidgetElements[c.id]=P,s.partsWidgetId[s.editPartChoose].add(c.id);const V=l(gt[a],{gs_id:c.id,el_name:a,el_size:{w:c.w,h:c.h}});V.appContext=n,Oe(V,P)}),Ge.setupDragIn(".sidebar-item",{helper:z})});const D=he(()=>$.params.hashCode,async(i,o)=>{if(s.clearBlueprint(),i&&i!==o)try{I.info(`正在加载蓝图: ${i}`),await s.loadBlueprintByHashCode(i),I.success(`蓝图 ${i} 加载成功！`)}catch(_){console.error("加载蓝图失败：",_),I.error(`加载蓝图失败: ${_.message}`)}else if(!i&&o)try{I.info("正在加载本地蓝图..."),s.loadLocalBlueprint()?I.success("本地蓝图加载成功！"):I.info("无本地蓝图数据")}catch(_){console.error("加载本地蓝图失败：",_),I.error(`加载本地蓝图失败: ${_.message}`)}}),v=()=>{ut.confirm("你确定要清空画布吗？确认后会直接清空画布，若清空后保存将会彻底无法恢复。","确认清空",{confirmButtonText:"我确认清空画布",cancelButtonText:"取消"}).then(i=>{i?(I.success("已经清空画布"),s.clearBlueprint()):I.info("清空画布已取消")})};return _e(()=>{D()}),(i,o)=>{const _=f("el-popconfirm"),C=f("upload-filled"),h=f("el-icon"),z=f("el-upload"),b=f("el-dialog"),k=f("el-col"),c=f("el-button"),P=f("el-row");return m(),U(N,null,[l(_,{title:"确认删除当前框选的所有传送带/管道？",visible:e(u).showSelectMenu,placement:"right-end",onCancel:e(u).hideSelectorAMenu,onConfirm:e(u).confirmDelete,onHide:e(u).handleMenuHide},{reference:r(()=>[q(t("div",{class:"selection-box",onMousedown:o[0]||(o[0]=(...a)=>e(u).handleMouseDown&&e(u).handleMouseDown(...a)),onMousemove:o[1]||(o[1]=(...a)=>e(u).handleMouseMove&&e(u).handleMouseMove(...a)),onMouseup:o[2]||(o[2]=(...a)=>e(u).handleMouseUp&&e(u).handleMouseUp(...a))},null,544),[[He,e(u).isStartSelect]])]),_:1},8,["visible","onCancel","onConfirm","onHide"]),l(e(K),{open:e(s).isRecipeChoose,"onUpdate:open":[o[3]||(o[3]=a=>e(s).isRecipeChoose=a),e(s).handleDialogRecipeClose]},{default:r(()=>[l(e(ee),{"max-width":"max-w-4xl"},{default:r(()=>[l(e(te),null,{default:r(()=>[l(e(oe),null,{default:r(()=>[...o[20]||(o[20]=[A("配方选择",-1)])]),_:1})]),_:1}),t("div",go,[l(ot)])]),_:1})]),_:1},8,["open","onUpdate:open"]),l(e(K),{open:e(s).isWareHouseRecipeChoose,"onUpdate:open":[o[4]||(o[4]=a=>e(s).isWareHouseRecipeChoose=a),e(s).handleDialogRecipeClose]},{default:r(()=>[l(e(ee),{"max-width":"max-w-4xl"},{default:r(()=>[l(e(te),null,{default:r(()=>[l(e(oe),null,{default:r(()=>[...o[21]||(o[21]=[A("仓库取货口配置",-1)])]),_:1})]),_:1}),l(lt)]),_:1})]),_:1},8,["open","onUpdate:open"]),l(b,{modelValue:e(s).isBluePrintImport,"onUpdate:modelValue":o[5]||(o[5]=a=>e(s).isBluePrintImport=a),width:"50%",onClose:e(s).handleDialogRecipeClose,"append-to-body":!0},{default:r(()=>[l(z,{drag:"",accept:".json,application/json","on-change":e(s).handleBluePrintUpload},{default:r(()=>[l(h,{class:"el-icon--upload"},{default:r(()=>[l(C)]),_:1}),o[22]||(o[22]=t("div",{class:"el-upload__text"},[A(" 拖动蓝图文件到此处 "),t("em",null,"或者点击上传")],-1))]),_:1},8,["on-change"])]),_:1},8,["modelValue","onClose"]),l(P,{gutter:6},{default:r(()=>[l(k,{span:4},{default:r(()=>[t("div",fo,[o[23]||(o[23]=t("div",{"data-gs-widget":'{"w":9, "h":9, "noResize":true, "id":"protocolCore"}',class:"sheng-cont-item sidebar-item display-flex flex-direation-row"},[t("div",{class:"display-flex flex-direation-col justify-content-center",style:{"margin-left":"3px"}},[t("div",{class:"display-flex flex-direation-col justify-content-center"},[t("span",{style:{"font-size":"14px"}},"协议核心")])])],-1)),o[24]||(o[24]=t("div",{"data-gs-widget":'{"w":3, "h":1, "noResize":true, "id":"warehouseWithdrawalPort"}',class:"sheng-cont-item sidebar-item display-flex flex-direation-row"},[t("div",{class:"display-flex flex-direation-col justify-content-center",style:{"margin-left":"3px"}},[t("div",{class:"display-flex flex-direation-col justify-content-center"},[t("span",{style:{"font-size":"14px"}},"仓库取货口")])])],-1)),o[25]||(o[25]=t("div",{"data-gs-widget":'{"w":3, "h":1, "noResize":true, "id":"warehouseDepositPort"}',class:"sheng-cont-item sidebar-item display-flex flex-direation-row"},[t("div",{class:"display-flex flex-direation-col justify-content-center",style:{"margin-left":"3px"}},[t("div",{class:"display-flex flex-direation-col justify-content-center"},[t("span",{style:{"font-size":"14px"}},"仓库存货口")])])],-1)),o[26]||(o[26]=t("div",{"data-gs-widget":'{"w":2, "h":2, "noResize":true, "id":"powerSupplier"}',class:"sheng-cont-item sidebar-item display-flex flex-direation-row"},[t("div",{class:"display-flex flex-direation-col justify-content-center",style:{"margin-left":"3px"}},[t("div",{class:"display-flex flex-direation-col justify-content-center"},[t("span",{style:{"font-size":"14px"}},"供电桩")])])],-1)),o[27]||(o[27]=t("div",{"data-gs-widget":'{"w":3, "h":3, "noResize":true, "id":"protocolStorageBox"}',class:"sheng-cont-item sidebar-item display-flex flex-direation-row"},[t("div",{class:"display-flex flex-direation-col justify-content-center",style:{"margin-left":"3px"}},[t("div",{class:"display-flex flex-direation-col justify-content-center"},[t("span",{style:{"font-size":"14px"}},"协议存储箱")])])],-1)),o[28]||(o[28]=t("div",{"data-gs-widget":'{"w":3, "h":3, "noResize":true, "id":"liquidContainer"}',class:"sheng-cont-item sidebar-item display-flex flex-direation-row"},[t("div",{class:"display-flex flex-direation-col justify-content-center",style:{"margin-left":"3px"}},[t("div",{class:"display-flex flex-direation-col justify-content-center"},[t("span",{style:{"font-size":"14px"}},"储液罐")])])],-1)),(m(!0),U(N,null,Y(e(ft),a=>(m(),U("div",{"data-gs-widget":e(mt)(a),class:"sheng-cont-item sidebar-item display-flex flex-direation-row",style:{position:"relative"}},[t("div",{class:"sheng-cont-item-bg",style:ae(e(ye)(a.icon,120,"#ffffff00"))},null,4),t("div",vo,[t("div",{style:ae([{width:"35px",height:"35px","background-size":"420px auto","margin-left":"6px"},e(ye)(a.icon,35)])},null,4)]),t("div",yo,[t("span",ho,G(a.name),1)])],8,mo))),256))])]),_:1}),l(k,{span:20},{default:r(()=>[t("div",_o,[t("div",bo,[l(e(at),{modelValue:e(s).toolbarMode,"onUpdate:modelValue":o[6]||(o[6]=a=>e(s).toolbarMode=a)},null,8,["modelValue"]),l(e(st),{modelValue:e(s).toolbarMode,"onUpdate:modelValue":o[7]||(o[7]=a=>e(s).toolbarMode=a)},null,8,["modelValue"]),l(e(nt),{modelValue:e(s).quickPlaceMode,"onUpdate:modelValue":o[8]||(o[8]=a=>e(s).quickPlaceMode=a)},null,8,["modelValue"]),l(c,{class:"ml-auto",icon:"Delete",onClick:v},{default:r(()=>[...o[29]||(o[29]=[A("清空",-1)])]),_:1}),l(e(rt),{"show-supplier-extent":e(s).isShowSupplierExtent,"onUpdate:showSupplierExtent":o[9]||(o[9]=a=>e(s).isShowSupplierExtent=a),"show-belts":e(s).isShowBelts,"onUpdate:showBelts":o[10]||(o[10]=a=>e(s).isShowBelts=a),"show-pipes":e(s).isShowPipes,"onUpdate:showPipes":o[11]||(o[11]=a=>e(s).isShowPipes=a),"show-pipe-port":e(s).isShowPipePort,"onUpdate:showPipePort":o[12]||(o[12]=a=>e(s).isShowPipePort=a)},null,8,["show-supplier-extent","show-belts","show-pipes","show-pipe-port"]),l(e(it),{parts:e(s).parts,"edit-part-choose":e(s).editPartChoose,onUpdatePart:e(s).handlePartShowChange,onSelectEditPart:e(s).selectEditPart,onCopyEditCode:e(s).copyEditCode,onDeletePart:e(s).deletePart,onAddNewPart:e(s).addNewPart},null,8,["parts","edit-part-choose","onUpdatePart","onSelectEditPart","onCopyEditCode","onDeletePart","onAddNewPart"]),l(e(dt),{onSave:e(s).saveBluePrint,onImport:e(s).handleBluePrintImportDialog,onExport:e(s).exportBluePrint},null,8,["onSave","onImport","onExport"])])]),t("div",{class:"sheng-cont-grid",onWheel:o[15]||(o[15]=(...a)=>e(s).handleScalingChange_&&e(s).handleScalingChange_(...a)),onContextmenu:o[16]||(o[16]=(...a)=>e(X).handleRightClick&&e(X).handleRightClick(...a)),onMousedown:o[17]||(o[17]=(...a)=>e(u).handleMouseDown&&e(u).handleMouseDown(...a)),onMousemove:o[18]||(o[18]=(...a)=>e(u).handleMouseMove&&e(u).handleMouseMove(...a)),onMouseup:o[19]||(o[19]=(...a)=>e(u).handleMouseUp&&e(u).handleMouseUp(...a))},[o[30]||(o[30]=t("div",{class:"sheng-overlay"},null,-1)),t("div",{onClick:o[13]||(o[13]=(...a)=>e(X).handleLeftClick&&e(X).handleLeftClick(...a)),class:"pipe-grid",id:"pipe-grid",style:ae([{"background-color":"transparent"},{pointerEvents:e(s).quickPlaceMode==="pipe"?"auto":"none"}])},null,4),t("div",{onClick:o[14]||(o[14]=(...a)=>e(X).handleLeftClick&&e(X).handleLeftClick(...a)),id:"grid-stack",class:"grid-stack bottom-grid-bg",style:ae([{"background-color":"#e5e7eb"},{pointerEvents:e(s).quickPlaceMode==="belt"?"auto":"none"}])},null,4)],32)]),_:1})]),_:1})],64)}}},xo=W(wo,[["__scopeId","data-v-8ae0781c"]]),Io=Object.freeze(Object.defineProperty({__proto__:null,default:xo},Symbol.toStringTag,{value:"Module"}));export{$o as R,Io as a,Uo as c,Mo as d,Po as h,Vo as i,Do as s};
